<div class="card">
  <div class="card-header text-muted">
    <h5 class="card-title">
      <span class="badge bg-primary text-bg-primary text-uppercase float-start">{{length this.permissions}}</span>
      <div class="fs-2 text-truncate ms-4 me-4 ps-2 pe-2" title="">{{> discord/user user=this.user_id guild=this.guild_id }}</div>
    </h5>
  </div>
  <div class="card-body">
    <div class="row">
      <div class="col">
        <div class="card-header text-uppercase"><span class="mb-1">Guild</span></div>
        <div class="mt-1">{{> discord/guild id=this.guild_id}}</div>
      </div>
      <div class="col">
        <div class="card-header text-uppercase"><span class="mb-1">User</span></div>
        <div class="mt-1">{{> discord/user user=this.user_id guild=this.guild_id }}</div>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col">

        <div class="card-header">
          <button 
            type="button" 
            class="btn text-success btn-sm float-end p-0" 
            aria-label="Add Permission" 
            title="Add Permission"
            data-bs-toggle="modal" 
            data-bs-target="#add-permission-{{this.guild_id}}-{{this.user_id}}">
            <i class="fas fa-plus" aria-hidden="true"></i>
          </button>
          <div class="text-uppercase">Permissions</div>
        </div>
        {{#each this.permissions}}
        <div class="mt-2 input-group">
          <div class="text-muted ms-1 mt-2 text-uppercase me-2">
            <i class="fas fa-tag me-1"></i>{{this}}<a href="/permissions/remove/{{../user_id}}/{{this}}" class="btn text-danger btn-sm ms-2 p-0"><i class="fas fa-trash"></i></a>
          </div>
        </div>
        {{/each}}
        {{!-- Add Permission Modal (scoped to this user & guild) --}}
        {{#> modal 
            id=(concat 'add-permission-' this.guild_id '-' this.user_id)
            title='Add Permission'
            buttonText='Add Permission'
            buttonClass='btn-success'
            cancelText='Cancel'
            formAction=(concat '/permissions/add/' this.guild_id '/' this.user_id)
            formMethod='POST'}}
          <div class="mb-3">
            <div class="mb-2">
              Add a new permission for {{> discord/user user=this.user_id guild=this.guild_id }}
            </div>
            <div class="input-group">
              <label class="input-group-text" for="permission-name-{{this.guild_id}}-{{this.user_id}}">Permission Name</label>
              <input 
                type="text" 
                class="form-control" 
                id="permission-name-{{this.guild_id}}-{{this.user_id}}" 
                name="permission" 
                placeholder="e.g. CLAIM_GAME_DISABLED" 
                required 
                maxlength="64"
                autofocus />
            </div>
          </div>
          <p class="small text-muted mb-0">Provide the exact permission key.</p>
        {{/modal}}
      </div>
    </div>
  </div>

  <div class="card-footer text-muted text-end">
  </div>
</div>